%& /home/adam/.config/TikzEdtWForms/TikzEdtWForms/0.2.1.0/temp_header
\begin{document}
\begin{tikzpicture}
% comment it out at the end
%\draw[help lines] (0,0) grid(20,20);

% STS rectangle
\coordinate (TLSTS) at (4,16);
\coordinate (BRSTS) at (12,12) {};

% LTS rectangle
\coordinate (TLLTS) at (4,10);
\coordinate (BRLTS) at (12,6);

% Data feeder rectangle
\coordinate (TLDF) at (0,15);
\coordinate (BRDF) at (2,13) {};

% Draw rectangles and their names in corners
\draw [ultra thick, rounded corners, blue] (TLSTS) rectangle (BRSTS);
\draw [ultra thick, rounded corners, blue] (TLLTS) rectangle (BRLTS);
\node [below right] at (TLSTS) {Short Term Smoother};
\node [below right] at (TLLTS) {Long Term Smoother};

% Draw Vision feeder
\draw [ultra thick, rounded corners, blue] (TLDF) rectangle (BRDF);
\node [below right] at (TLDF) {Data input};

% Draw data flow
\draw [thick, ->] ($(BRDF) + (0,1.5)$) -- ($(TLSTS) - (0,1.5)$) node [above left] {Vision};
\draw [thick, ->] ($(BRDF) + (0,1)$) -- ($(TLSTS) - (0,2)$) node [above left] {IMU};
\draw [thick, ->] ($(BRDF) + (0,0.5)$) -- ($(TLSTS) - (0,2.5)$) node [above left] {GPS};
\draw [thick, ->] ($(BRDF) + (0,0.5)$) -- ($(BRDF) + (1,0.5)$)
  -- ($(BRDF) + (1,-5)$) --  ($(TLLTS) - (0,2)$)  node [above left] {GPS};

\draw [thick, ->] ($(TLSTS)+(1,-4)$) -- ($(TLLTS)+(1,0)$);
\draw [thick, ->] ($(TLSTS)+(1.5,-4)$) -- ($(TLLTS)+(1.5,0)$);
\draw [thick, ->] ($(TLSTS)+(2,-4)$) -- ($(TLLTS)+(2,0)$);

\node [align=left, right] at (6,11) {Pose estimates\\Vision\\IMU};

\draw [thick, ->] ($(TLLTS)+(6,0)$) -- ($(TLSTS)+(6,-4)$);
\node [align=left, right] at (10,11) {"fixed" \\landmark positions};


% node [right] {Pose estimates};

% TODO not a nice solution to include the pdf
\node at (10,14) {\includegraphics[scale=0.3]{./../factor_graph/factor_graph.pdf}};
\node at (10,8) {\includegraphics[scale=0.3]{./../factor_graph/factor_graph.pdf}};


%% TODO add it below \end
%\caption{Do not forget!
%Make it explicit enough that readers
%can figure out what you are doing.}

\draw  (5.5,8.5) ellipse (1 and 0.5);
\node (v2) at (4.5,8.5) {};
\node (v3) at (6.5,8.5) {};
\node (v1) at (4.5,6.5) {};
\node at (5.5,6.5) {};
\node (v4) at (6.5,6.5) {};
\draw  (v1) edge (v2);
\draw  (5.5,6.5) ellipse (1 and 0.5);
\draw  (v3) edge (v4);
\node at (5.5,7.5) {Map};

\usetikzlibrary{calc}
\pgftransformreset
\node[inner sep=0pt,outer sep=0pt,minimum size=0pt,line width=0pt,text width=0pt,text height=0pt] at (current bounding box) {};
%add border to avoid cropping by pdflibnet
\foreach \border in {0.1}
  \useasboundingbox (current bounding box.south west)+(-\border,-\border) rectangle (current bounding box.north east)+(\border,\border);
\newwrite\metadatafile
\immediate\openout\metadatafile=\jobname_BB.txt
\path
  let
    \p1=(current bounding box.south west),
    \p2=(current bounding box.north east)
  in
  node[inner sep=0pt,outer sep=0pt,minimum size=0pt,line width=0pt,text width=0pt,text height=0pt,draw=white] at (current bounding box) {
\immediate\write\metadatafile{\p1,\p2}
};
\immediate\closeout\metadatafile
\end{tikzpicture}


    
    
    

\end{document}
